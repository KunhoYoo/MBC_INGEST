
<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Ïú†ÌäúÎ∏å Í∏∞Î°ù</title>
<style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 1rem;
      color: #333;
    }

    h2 {
      text-align: center;
      color: #003366;
    }

    table {
      border: 1px solid #ccc;
      border-collapse: collapse;
    
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }

    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
      font-size: 0.9rem;
    
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
      font-size: 0.9rem;
    
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      font-size: 0.9rem;
    }

    input[type="text"], input[type="date"] {
      width: 95%;
      padding: 4px;
      font-size: 0.85rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    
      width: 95%;
      padding: 5px;
      font-size: 0.9rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    button {
      margin: 5px;
      padding: 6px 10px;
      background-color: #003366;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 0.85rem;
    
      margin: 5px;
      padding: 8px 12px;
      background-color: #003366;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 0.9rem;
    }

    button:hover {
      background-color: #002244;
    }

    img.thumbnail {
      width: 400px;
      height: auto;
      cursor: pointer;
    
      width: 120px;
      height: auto;
      cursor: pointer;
    }

    .center-buttons {
      text-align: center;
      margin-top: 1rem;
    }

    @media (max-width: 768px) {
      th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
      font-size: 0.9rem;
    
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
      font-size: 0.9rem;
    
        font-size: 0.8rem;
        padding: 5px;
      }

      img.thumbnail {
      width: 400px;
      height: auto;
      cursor: pointer;
    
        width: 80px;
      }
    }
  
    th {
      background-color: #003366;
      color: white;
    }


@media (max-width: 600px) {
  tr {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
    padding: 0.5rem 0.7rem;
  }

  .card-header {
    display: flex;
    align-items: flex-start;
    gap: 0.6rem;
  }

  .card-thumbnail {
    flex: 0 0 100px;
  }

  .card-header-info {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    gap: 0.3rem;
  }

  .card-row {
    display: flex;
    justify-content: space-between;
    gap: 0.5rem;
  }

  .card-row label {
    font-weight: bold;
    font-size: 0.8rem;
    flex: 0 0 50px;
  }

  .card-row input {
    flex-grow: 1;
    font-size: 0.8rem;
    padding: 4px;
  }

  .card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 4px;
  }

  .thumbnail {
    width: 100px;
    height: auto;
    border-radius: 4px;
  }

  button {
    padding: 4px 8px;
    font-size: 0.8rem;
  }
}


  thead {
    display: none;
  }

  tr {
    margin-bottom: 1.5rem;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 0.5rem;
    background: #fff;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }

  td {
    text-align: left !important;
    padding: 4px 10px;
    font-size: 0.85rem;
    border: none;
    position: relative;
  }

  td::before {
    content: attr(data-label);
    font-weight: bold;
    display: block;
    margin-bottom: 2px;
    color: #003366;
  }

  .thumbnail {
    width: 100%;
    max-width: 100%;
    height: auto;
    margin-bottom: 0.5rem;
  }

  input[type="text"], input[type="date"] {
    font-size: 0.9rem;
    width: 100%;
  }

  .btn-row, #pagination-nav {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.5rem;
  }
}



@media (max-width: 600px) {
  tr {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
    padding: 0.5rem 0.7rem;
  }

  .card-header {
    display: flex;
    align-items: flex-start;
    gap: 0.6rem;
  }

  .card-thumbnail {
    flex: 0 0 100px;
  }

  .card-header-info {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    gap: 0.3rem;
  }

  .card-row {
    display: flex;
    justify-content: space-between;
    gap: 0.5rem;
  }

  .card-row label {
    font-weight: bold;
    font-size: 0.8rem;
    flex: 0 0 50px;
  }

  .card-row input {
    flex-grow: 1;
    font-size: 0.8rem;
    padding: 4px;
  }

  .card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 4px;
  }

  .thumbnail {
    width: 100px;
    height: auto;
    border-radius: 4px;
  }

  button {
    padding: 4px 8px;
    font-size: 0.8rem;
  }
}


  .card-header {
    display: flex;
    align-items: center;
    gap: 0.7rem;
  }

  .card-thumbnail {
    flex: 0 0 120px;
  }

  .card-header-info {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  .card-row {
    display: flex;
    justify-content: space-between;
    gap: 0.5rem;
  }

  .card-row label {
    font-weight: bold;
    flex: 0 0 60px;
  }

  .card-row input {
    flex-grow: 1;
    font-size: 0.9rem;
  }

  .card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .thumbnail {
    width: 100%;
    max-width: 100%;
    height: auto;
    border-radius: 5px;
  }
}


@media (max-width: 768px) {
  thead {
    display: none;
  }
  .card-row {
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: 8px;
    padding: 8px;
    border: 1px solid #ccc;
    margin-bottom: 10px;
    border-radius: 8px;
  }
  .card-thumb {
    width: 120px;
    flex-shrink: 0;
  }
  .card-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
    font-size: 14px;
  }
  .card-header {
    display: flex;
    justify-content: space-between;
  }
  .card-meta {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 8px;
  }
}


@media (max-width: 768px) {
  .card-row {
    display: flex;
    flex-direction: row;
    gap: 4px;
    padding: 4px;
    margin-bottom: 6px;
    border: 1px solid #ccc;
    border-radius: 6px;
  }
  .card-thumb {
    width: 100px;
    flex-shrink: 0;
  }
  .card-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;
    font-size: 13px;
  }
  .card-content input {
    padding: 4px;
    font-size: 13px;
  }
  .card-meta {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 4px;
  }
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2px;
  }
  .card-content div {
    margin-bottom: 2px;
  }
}


@media (max-width: 768px) {
  .card-row {
    display: flex;
    flex-direction: column;
    padding: 6px;
    margin-bottom: 8px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 13px;
  }

  .card-top-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 6px;
    gap: 6px;
  }

  .card-no-thumb {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 8px;
  }

  .card-no {
    font-weight: bold;
    font-size: 14px;
  }

  .card-thumb {
    width: 90px;
    height: auto;
    border-radius: 4px;
  }

  .card-memo-delete {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    flex-grow: 1;
    gap: 4px;
  }

  .card-memo-delete input {
    padding: 4px;
    font-size: 13px;
  }

  .card-memo-delete button {
    align-self: flex-end;
  }

  .card-content {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .card-content input {
    font-size: 13px;
    padding: 4px;
  }
}
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js">
function safeHTML(str) {
  return (str || "").replace(/&/g, "&amp;")
                   .replace(/</g, "&lt;")
                   .replace(/>/g, "&gt;")
                   .replace(/"/g, "&quot;")
                   .replace(/'/g, "&#039;");
}

</script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js">
function safeHTML(str) {
  return (str || "").replace(/&/g, "&amp;")
                   .replace(/</g, "&lt;")
                   .replace(/>/g, "&gt;")
                   .replace(/"/g, "&quot;")
                   .replace(/'/g, "&#039;");
}

</script>
<script>
    const firebaseConfig = {
      apiKey: "AIzaSyACkd1QzPgDnmRz3b206e4IiePiS55keio",
      authDomain: "mbc-ingest.firebaseapp.com",
      databaseURL: "https://mbc-ingest-default-rtdb.firebaseio.com",
      projectId: "mbc-ingest",
      storageBucket: "mbc-ingest.appspot.com",
      messagingSenderId: "700019516",
      appId: "1:700019516:web:09f8b929973059316ea439"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const currentUser = new URLSearchParams(window.location.search).get('user') || 'unknown';

    function saveToFirebase(data) {
      db.ref('youtube_records/' + currentUser).set(data).then(() => {
        console.log("Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• ÏôÑÎ£å");
      }).catch(err => {
        alert("Ï†ÄÏû• Ïã§Ìå®: " + err.message);
      });
    }

    function loadFromFirebase() {
      db.ref('youtube_records/' + currentUser).once('value').then(snapshot => {
        const data = snapshot.val();
        if (data) {
          tbody.innerHTML = "";
          data.forEach((item, i) => {
            const row = tbody.insertRow();
            row.innerHTML = `
              <td>${i + 1}</td>
              <td data-label="Ïç∏ÎÑ§Ïùº"><img src="https://img.youtube.com/vi/${item.videoId}/0.jpg" alt="Ïç∏ÎÑ§Ïùº" class="thumbnail" onclick="if (this.hasAttribute('readonly')) { window.open('${item.url}', '_blank'); navigator.clipboard.writeText('${item.url}'); }"/></td>
              <td data-label="Ï†úÎ™©"><input type="text" class="title" value="${item.title}" readonly/></td>
              <td data-label="ÎÇ†Ïßú" style="text-align:center;"><input type="date" class="date" value="${item.date}" disabled/></td>
              <td data-label="Ï£ºÏÜå"><input type="text" class="url" value="${item.url}" readonly onclick="if (this.hasAttribute('readonly')) { window.open('${item.url}', '_blank'); navigator.clipboard.writeText('${item.url}'); }"/></td>
              <td data-label="Î©îÎ™®" style='width: 100px;'><input type="text" class="memo" value="${item.memo}" readonly onclick="if (this.hasAttribute('readonly')) { navigator.clipboard.writeText(this.value); alert('Î©îÎ™® Î≥µÏÇ¨Îê®'); }"/></td>
              <td data-label="ÏÇ≠Ï†ú"><button onclick="deleteRow(this)">üóëÔ∏è</button></td>
            `;
          });
        }
      });
    }

    
window.addEventListener('load', loadFromFirebase);

function loadFromFirebase() {
  db.ref('youtube_records/' + currentUser).once('value').then(snapshot => {
    const data = snapshot.val();
    if (data) {
      savedData = data.sort((a, b) => new Date(b.date) - new Date(a.date));
      renderPage(savedData);
    }
  });
}

  
function safeHTML(str) {
  return (str || "").replace(/&/g, "&amp;")
                   .replace(/</g, "&lt;")
                   .replace(/>/g, "&gt;")
                   .replace(/"/g, "&quot;")
                   .replace(/'/g, "&#039;");
}

</script>
</head>
<body>
<div style="text-align:center; margin: 10px 0;">
<img alt="MBC Ïù∏Ï†úÏä§Ìä∏ Note" onclick="window.location.href='index.html'" src="title_logo.png" style="cursor:pointer; max-width: 400px; width: 60%; height: auto;"/>
</div>
<div style="text-align:center; margin: 1rem 0;">
<input id="search-input" placeholder="Ï†úÎ™© Í≤ÄÏÉâ" style="padding: 8px; width: 80%; max-width: 600px; font-size: 0.9rem;" type="text"/>
<button onclick="searchRecords()">Í≤ÄÏÉâ</button>
</div>
<table id="recordTable">
<thead>
<tr>
<th>No.</th>
<th>Ïç∏ÎÑ§Ïùº</th>
<th>Ï†úÎ™©</th>
<th>ÎÇ†Ïßú</th>
<th>Ï£ºÏÜå</th>
<th>Î©îÎ™®</th>
<th>ÏÇ≠Ï†ú</th>
</tr>
</thead>
<tbody></tbody>
</table>
<div class="center-buttons">
<button onclick="addRow()">Ï∂îÍ∞Ä</button>
<button onclick="editRows()">Ìé∏Ïßë</button>
<button onclick="saveRows()">Ï†ÄÏû•</button>
</div>
<script>
    const tbody = document.querySelector("#recordTable tbody");
    let savedData = [];

    function getToday() {
      const d = new Date();
      return d.toISOString().split("T")[0];
    }

    function extractVideoId(url) {
      try {
        const urlObj = new URL(url);
        if (urlObj.hostname === "youtu.be") return urlObj.pathname.slice(1);
        if (urlObj.hostname.includes("youtube.com")) return urlObj.searchParams.get("v");
        return null;
      } catch {
        return null;
      }
    }

    async function fetchYouTubeTitle(videoId) {
      try {
        const response = await fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${videoId}`);
        const data = await response.json();
        return data.title || "Ï†úÎ™© ÏóÜÏùå";
      } catch {
        return "Ï†úÎ™© Ïò§Î•ò";
      }
    }

    function addRow() {
      const row = tbody.insertRow();
      const idx = tbody.rows.length;

      row.innerHTML = `
        <td>${idx}</td>
        <td><img src="" alt="Ïç∏ÎÑ§Ïùº" class="thumbnail"/></td>
        <td data-label="Ï†úÎ™©"><input type="text" class="title"/></td>
        <td><input type="date" class="date" value="${getToday()}"/></td>
        <td data-label="Ï£ºÏÜå"><input type="text" class="url" oninput="updateFromURL(this)"/></td>
        <td data-label="Î©îÎ™®" style='width: 100px;'><input type="text" class="memo"/></td>
        <td data-label="ÏÇ≠Ï†ú"><button onclick="deleteRow(this)">üóëÔ∏è</button></td>
      `;
    }

    function updateFromURL(input) {
      const row = input.closest("tr");
      const videoId = extractVideoId(input.value);
      if (!videoId) return;

      const thumbnail = row.querySelector("img.thumbnail");
      const titleInput = row.querySelector(".title");

      thumbnail.src = `https://img.youtube.com/vi/${videoId}/0.jpg`;
      thumbnail.onclick = () => {
        navigator.clipboard.writeText(input.value);
        window.open(input.value, '_blank');
      };

      fetchYouTubeTitle(videoId).then(title => {
        titleInput.value = title;
      });

      const dateInput = row.querySelector(".date");
      dateInput.value = getToday();
    }

    function deleteRow(btn) {
      if (!confirm("Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) return;

      const row = btn.closest("tr");
      row.remove();
      updateRowIndices();
    }

    function updateRowIndices() {
      [...tbody.rows].forEach((row, i) => row.cells[0].textContent = i + 1);
    }

    function saveRows() {
      let data = [...tbody.rows].map(row => {
        const escapeHTML = (str) => (str || "").replace(/&/g, "&amp;")
                                              .replace(/</g, "&lt;")
                                              .replace(/>/g, "&gt;")
                                              .replace(/"/g, "&quot;")
                                              .replace(/'/g, "&#039;");

        const videoId = extractVideoId(row.querySelector(".url").value);
        const url = row.querySelector(".url").value;
        const title = row.querySelector(".title").value;
        const date = row.querySelector(".date").value;
        const memo = row.querySelector(".memo").value;
        return { videoId, url: escapeHTML(url), title: escapeHTML(title), date, memo: escapeHTML(memo) };
      });

      data.sort((a, b) => new Date(b.date) - new Date(a.date));
      tbody.innerHTML = "";

      data.forEach((item, i) => {
        const row = tbody.insertRow();
        row.innerHTML = `
          <td>${i + 1}</td>
          <td data-label="Ïç∏ÎÑ§Ïùº"><img src="https://img.youtube.com/vi/${item.videoId}/0.jpg" alt="Ïç∏ÎÑ§Ïùº" class="thumbnail" onclick="if (this.hasAttribute('readonly')) { window.open('${item.url}', '_blank'); navigator.clipboard.writeText('${item.url}'); }"/></td>
          <td data-label="Ï†úÎ™©"><input type="text" class="title" value="${item.title}" readonly/></td>
          <td data-label="ÎÇ†Ïßú" style="text-align:center;"><input type="date" class="date" value="${item.date}" disabled/></td>
          <td data-label="Ï£ºÏÜå"><input type="text" class="url" value="${item.url}" readonly onclick="if (this.hasAttribute('readonly')) { window.open('${item.url}', '_blank'); navigator.clipboard.writeText('${item.url}'); }"/></td>
          <td data-label="Î©îÎ™®" style='width: 100px;'><input type="text" class="memo" value="${item.memo}" readonly onclick="if (this.hasAttribute('readonly')) { navigator.clipboard.writeText(this.value); alert('Î©îÎ™® Î≥µÏÇ¨Îê®'); }"/></td>
          <td data-label="ÏÇ≠Ï†ú"><button onclick="deleteRow(this)">üóëÔ∏è</button></td>
        `;
      });

      savedData = data;
      renderPage(savedData);
      saveToFirebase(data);
      alert("Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!");
    }

    function editRows() {
      [...tbody.rows].forEach(row => {
        row.querySelectorAll("input").forEach(input => input.removeAttribute("readonly"));
        row.querySelectorAll("input[type='date']").forEach(input => input.removeAttribute("disabled"));
      });
    }
  
function safeHTML(str) {
  return (str || "").replace(/&/g, "&amp;")
                   .replace(/</g, "&lt;")
                   .replace(/>/g, "&gt;")
                   .replace(/"/g, "&quot;")
                   .replace(/'/g, "&#039;");
}

</script>
<script>
let currentPage = 1;
const rowsPerPage = 20;

function renderPage(data) {
  tbody.innerHTML = "";
  const start = (currentPage - 1) * rowsPerPage;
  const end = start + rowsPerPage;
  const pageData = data.slice(start, end);

  pageData.forEach((item, i) => {
    const row = tbody.insertRow();
    row.innerHTML = `
      <td data-label="No.">${start + i + 1}</td>
      <td data-label="Ïç∏ÎÑ§Ïùº"><img src="https://img.youtube.com/vi/${item.videoId}/0.jpg" alt="Ïç∏ÎÑ§Ïùº" class="thumbnail" onclick="if (this.hasAttribute('readonly')) { window.open('${item.url}', '_blank'); navigator.clipboard.writeText('${item.url}'); }"/></td>
      <td data-label="Ï†úÎ™©"><input type="text" class="title" value="${item.title}" readonly/></td>
      <td data-label="ÎÇ†Ïßú" style="text-align:center;"><input type="date" class="date" value="${item.date}" disabled/></td>
      <td data-label="Ï£ºÏÜå"><input type="text" class="url" value="${item.url}" readonly onclick="if (this.hasAttribute('readonly')) { window.open('${item.url}', '_blank'); navigator.clipboard.writeText('${item.url}'); }"/></td>
      <td data-label="Î©îÎ™®" style='width: 100px;'><input type="text" class="memo" value="${item.memo}" readonly onclick="if (this.hasAttribute('readonly')) { navigator.clipboard.writeText(this.value); alert('Î©îÎ™® Î≥µÏÇ¨Îê®'); }"/></td>
      <td data-label="ÏÇ≠Ï†ú"><button onclick="deleteRow(this)">üóëÔ∏è</button></td>
    `;
  });

  renderPagination(data.length);
}

function renderPagination(totalRows) {
  const totalPages = Math.ceil(totalRows / rowsPerPage);
  let nav = document.getElementById("pagination-nav");
  if (!nav) {
    nav = document.createElement("div");
    nav.id = "pagination-nav";
    nav.style.textAlign = "center";
    nav.style.marginTop = "1rem";
    document.body.appendChild(nav);
  }
  nav.innerHTML = "";
  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    btn.style.margin = "0 5px";
    btn.onclick = () => {
      currentPage = i;
      renderPage(savedData);
    };
    nav.appendChild(btn);
  }
}

function safeHTML(str) {
  return (str || "").replace(/&/g, "&amp;")
                   .replace(/</g, "&lt;")
                   .replace(/>/g, "&gt;")
                   .replace(/"/g, "&quot;")
                   .replace(/'/g, "&#039;");
}

</script>
<script>
function searchRecords() {
  const keyword = document.getElementById('search-input').value.trim().toLowerCase();
  const filtered = savedData.filter(item => item.title.toLowerCase().includes(keyword));
  currentPage = 1;
  renderPage(filtered);
}

function safeHTML(str) {
  return (str || "").replace(/&/g, "&amp;")
                   .replace(/</g, "&lt;")
                   .replace(/>/g, "&gt;")
                   .replace(/"/g, "&quot;")
                   .replace(/'/g, "&#039;");
}

</script>
</body>
</html>
