<!DOCTYPE html>

<html lang="ko">
<head>
<!-- KakaoTalk Sharing Thumbnail -->
<meta content="MBC 인제스트 Note" property="og:title"/>
<meta content="MBC 촬영 인제스트 내용을 기록하고 공유하세요." property="og:description"/>
<meta content="mbc_logo.jpg" property="og:image"/>
<meta content="https://kunhoyoo.github.io/MBC_INGEST/" property="og:url"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>MBC 인제스트 Note</title>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Barun+Gothic&amp;display=swap" rel="stylesheet"/>
<style>
    body {
      font-family: 'Nanum Barun Gothic', sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 1rem;
      text-align: center;
    }
    h1 {
      color: #004080;
      cursor: pointer;
    }
    .form-group {
      margin-bottom: 1rem;
      text-align: left;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 0.3rem;
    }
    input, textarea {
      white-space: pre-wrap;
      width: 95%;
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    textarea#content {
      height: 300px !important;
    }
    #login-code {
      width: 300px;
      margin: 0 auto;
      display: block;
      text-align: center;
    }
    button {
      background: #004080;
      color: white;
      padding: 0.75rem 0.5rem;
      font-size: 0.9rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 0.2rem;
    }
    button:hover {
      background: #003060;
    }
    button.reset-btn {
      background: #002244;
    }
    button.reset-btn:hover {
      background: #001a33;
    }
    .btn-row {
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      gap: 0.3rem;
      margin-top: 1.5rem;
    }
    .btn-row button {
      width: 18%;
      max-width: 80px;
      font-size: 0.75rem;
      padding: 0.5rem 0.4rem;
    }
    #login-section, #form-section {
      max-width: 700px;
      margin: auto;
      display: none;
    }
    #login-section.active, #form-section.active {
      display: block;
    }
    #sms-popup {
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translate(-50%, -30%);
      background: white;
      padding: 20px;
      border: 2px solid #004080;
      border-radius: 8px;
      z-index: 1000;
      width: 80%;
      max-width: 500px;
      display: none;
    }
    #sms-popup textarea {
      width: 100%;
      height: 120px;
      margin-bottom: 10px;
    }
    #sms-popup .btn-row {
      display: flex;
      justify-content: flex-end;
    }
  </style>
<style>
.slider-wrapper {
  width: 90%;
  margin: 20px auto;
  overflow: hidden;
  position: relative;
}
.slider-container {
  display: flex;
  transition: transform 0.5s ease;
}
.slider-item {
  min-width: 100%;
  box-sizing: border-box;
  text-align: center;
}
.slider-item img {
  max-height: 400px;
  max-width: 100%;
  display: block;
  margin: 0 auto;
}
.slider-nav {
  text-align: center;
  margin-top: 10px;
}
.slider-nav button {
  background-color: #004080;
  color: white;
  border: none;
  margin: 0 5px;
  padding: 8px 12px;
  cursor: pointer;
  border-radius: 4px;
}
</style>
<style>
* {
  margin:0;
  padding:0;
  box-sizing:border-box;
}
body {
  width:100%;
  height:100vh;
  overflow:hidden;
}
.container {
  width:100%;
  height:100%;
  perspective:500px;
  transform-style: preserve-3d;
  position: relative;
}
.slide {
  transition:0.5s;
  width:200px;
  box-shadow:0 10px 50px gray;
  height:300px;
  background:white;
  border:1px solid rgba(0,0,0,0.1);
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
}
.slide:nth-of-type(1),.slide:nth-of-type(2){  
  transform:translate(calc(-50%*5.1),-50%) translateZ(-100px);
}
.slide:nth-of-type(3){
  transform:translate(calc(-50%*3.1),-50%) translateZ(-50px);
}
.slide:nth-of-type(4){
   transform:translate(calc(-50%*1.1),-50%) translateZ(50px) ;
}
.slide:nth-of-type(5){
    transform:translate(calc(-50%*-0.9),-50%) translateZ(-50px) ;
}
.slide:nth-of-type(6),.slide:nth-of-type(7){
  transform:translate(calc(-50%*-2.9),-50%) translateZ(-100px) ;
}
.buttons {
  position:absolute;
  z-index:1;
  bottom:1em;
  left:50%;
  transform:translate(-50%);
}
</style>

</head>
<body>
<div id="login-logo-wrapper" style="display: none;"><br/><br/><br/><br/><br/><br/><br/><br/><img alt="MBC 인제스트 Note" onclick="goToLogin();" src="title_logo.png" style="cursor:pointer; max-width: 400px; width: 50%; height: auto; margin: 30px auto 10px auto; display: block;"/></div>
<div class="active" id="login-section">
<div class="form-group" style="text-align: center;">
<input id="login-code" maxlength="10" placeholder="코드를 입력하세요" style="width: 340px;" type="password"/>
</div>
<div style="margin-top: 0.5rem; text-align: center;">
<button id="login-btn" onclick="login()" style="width: 358px;">로그인</button><button id="canteen-btn" onclick="showCanteen()" style="width: 358px;">구내식당</button>
</div>
</div>
<div id="form-section">
<img alt="MBC 인제스트 Note" onclick="goToLogin()" src="title_logo.png" style="cursor:pointer; max-width: 400px; width: 50%; height: auto; margin: 30px auto 10px auto; display: block;"/>
<div class="form-group"><label>의뢰자</label><input id="client" type="text"/></div>
<div class="form-group"><label>의뢰형식</label><input id="request_type" type="text" value="원본"/></div>
<div class="form-group"><label>촬영일</label><input id="shoot_date" type="date"/></div>
<div class="form-group"><label>대분류</label><input id="category_main" type="text"/></div>
<div class="form-group"><label>소분류</label><input id="category_sub" type="text"/></div>
<div class="form-group"><label>제목</label><input id="title" type="text"/></div>
<div class="form-group"><label>특이사항</label><textarea id="notes"></textarea></div>
<div class="form-group"><label>촬영내용</label><textarea id="content"></textarea></div>
<div class="form-group"><label>촬영장소</label><input id="location" type="text"/></div>
<div class="form-group"><label>영상기자</label><input id="videographer" type="text"/></div>
<div class="form-group"><label>취재기자</label><input id="reporter" type="text"/></div>
<div class="form-group"><label>영상PD/VJ</label><input id="vj" type="text"/></div>
<div class="form-group"><label>카드번호</label><input id="card_number" type="text"/></div>
<div class="form-group"><label>촬영장비</label><input id="equipment" type="text"/></div>
<div class="btn-row">
<button class="reset-btn" onclick="confirmReset()">리셋</button>
<button onclick="openSMSPopup()">의뢰 내용</button>
<button onclick="copyAndShare()">복사</button>
<button onclick="downloadTXT()">추출</button>
<button onclick="saveToServer()">서버</button>
</div>
</div>
<div id="sms-popup">
<textarea id="sms-text" placeholder="의뢰 내용을 붙여넣기 하세요
[Web발신] &lt;- 삭제 후 입력 필요"></textarea>
<div class="btn-row">
<button onclick="parseSMSAndInsert()">입력</button>
<button onclick="closeSMSPopup()">취소</button>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyACkd1QzPgDnmRz3b206e4IiePiS55keio",
    authDomain: "mbc-ingest.firebaseapp.com",
    databaseURL: "https://mbc-ingest-default-rtdb.firebaseio.com",
    projectId: "mbc-ingest",
    storageBucket: "mbc-ingest.firebasestorage.app",
    messagingSenderId: "700019516",
    appId: "1:700019516:web:09f8b929973059316ea439"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const allowedCodes = ["rjsgh1","rjsgh2","rjsgh3","rjsgh4","rjsgh5","0001","0002","0003","0004","0005","alstkd1","alstkd2","alstkd3","alstkd4","alstkd5","gustn1","gustn2","gustn3","gustn4","gustn5"];
  let currentUser = null;

  function login() {
    currentUser = document.getElementById('login-code').value;
    if (allowedCodes.includes(currentUser)) {
      document.getElementById('login-section').classList.remove('active');
      document.getElementById('form-section').classList.add('active');
      loadData();
      loadFromServer();
      setDefaultDate();
    } else {
      alert('잘못된 로그인 코드입니다.');
    }
  }

  function goToLogin() {
  document.getElementById('login-section').classList.add('active');
  document.getElementById('login-section').style.display = 'block';
  document.getElementById('form-section').classList.remove('active');
  document.getElementById('form-section').style.display = 'none';
  document.getElementById('canteen-section').style.display = 'none';
  document.getElementById('login-logo-wrapper').style.display = 'block';
  currentUser = null;
}

  function resetForm() {
    document.querySelectorAll('#form-section input, #form-section textarea').forEach(el => el.value = '');
    document.getElementById('request_type').value = '원본';
    setDefaultDate();
    saveData();
  }

  function setDefaultDate() {
    const now = new Date();
    const offset = 9 * 60 * 60 * 1000;
    const kst = new Date(now.getTime() + offset);
    const yyyy = kst.getFullYear();
    const mm = String(kst.getMonth() + 1).padStart(2, '0');
    const dd = String(kst.getDate()).padStart(2, '0');
    document.getElementById('shoot_date').value = `${yyyy}-${mm}-${dd}`;
  }

  function generateContent() {
    const fields = [['의뢰자', 'client'], ['의뢰형식', 'request_type'], ['촬영일', 'shoot_date'], ['대분류', 'category_main'], ['소분류', 'category_sub'], ['제목', 'title'], ['특이사항', 'notes'], ['촬영내용', 'content'], ['촬영장소', 'location'], ['영상기자', 'videographer'], ['취재기자', 'reporter'], ['영상PD/VJ', 'vj'], ['카드번호', 'card_number'], ['촬영장비', 'equipment']];
    let content = ``;
    fields.forEach(([label, id], idx) => {
  content += `${label}: ${document.getElementById(id).value}`;
  if (idx < fields.length - 1) content += `\n`;
});
    return content;
  }

  function downloadTXT() {
    const content = generateContent();
    const blob = new Blob([content], { type: 'text/plain' });
    const a = document.createElement('a');
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth() + 1).padStart(2, '0');
    const dd = String(now.getDate()).padStart(2, '0');
    const hh = String(now.getHours()).padStart(2, '0');
    const min = String(now.getMinutes()).padStart(2, '0');
    const ss = String(now.getSeconds()).padStart(2, '0');
    const dateStr = `${yyyy}${mm}${dd}`;
    const timeStr = `${hh}${min}${ss}`;
    const title = document.getElementById('title').value.replace(/[^a-zA-Z0-9가-힣]/g, '').slice(0, 20);
    const filename = `${dateStr}_${timeStr}_${title || "Untitled"}.txt`;
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
  }

  function copyAndShare() {
    const content = generateContent();
    navigator.clipboard.writeText(content).then(() => {
      alert("내용이 클립보드에 복사되었습니다. 카카오톡에서 붙여넣기 하세요.");
    });
  }

  function confirmReset() {
    if (confirm("정말 리셋 하시겠습니까?")) {
      resetForm();
    }
  }

  function saveToServer(isAuto = false) {
    if (!currentUser) return;
    const data = {};
    document.querySelectorAll('#form-section input, #form-section textarea').forEach(el => {
      data[el.id] = el.value;
    });
    db.ref('ingest_notes/' + currentUser).set(data).then(() => {
      if (!isAuto) alert("서버에 동기화되었습니다.");
    });
  }

  function loadFromServer() {
    if (!currentUser) return;
    db.ref('ingest_notes/' + currentUser).once('value').then(snapshot => {
      const data = snapshot.val();
      if (data) {
        Object.entries(data).forEach(([key, value]) => {
          const el = document.getElementById(key);
          if (el) el.value = value;
        });
      }
    });
  }

  function saveData() {
    if (!currentUser) return;
    const data = {};
    document.querySelectorAll('#form-section input, #form-section textarea').forEach(el => {
      data[el.id] = el.value;
    });
    localStorage.setItem('ingest_data_' + currentUser, JSON.stringify(data));
  }

  function loadData() {
    if (!currentUser) return;
    const data = JSON.parse(localStorage.getItem('ingest_data_' + currentUser) || '{}');
    Object.entries(data).forEach(([key, value]) => {
      const el = document.getElementById(key);
      if (el) el.value = value;
    });
  }

  function openSMSPopup() {
    document.getElementById('sms-popup').style.display = 'block';
  }

  function closeSMSPopup() {
    document.getElementById('sms-popup').style.display = 'none';
    document.getElementById('sms-text').value = '';
  }



function parseSMSAndInsert() {
  const sms = document.getElementById('sms-text').value.trim();
  const firstLine = sms.split('\n')[0];
  const parts = firstLine.split(',').map(e => e.trim());

  const title = parts[0] || "";
  const reporter = parts[1] || "";
  const third = parts[2] || "";
  const location = parts[4] || "";

  const VJ_NAMES = [
    "이주혁", "독고명", "김백승", "강재훈", "이관호", 
    "임지환", "이원석", "우성훈", "김창인", 
    "황주연", "김민승", "정영진"
  ];

  if (title) {
    document.getElementById('title').value = title;
    const contentBox = document.getElementById('content');
    contentBox.value = title + '\n' + contentBox.value;
  }

  if (reporter) {
    document.getElementById('reporter').value = reporter;
  }

  if (third) {
    const isVJ = VJ_NAMES.includes(third);
    if (isVJ) {
      document.getElementById('vj').value = third;
      document.getElementById('equipment').value = "6mm";
    } else {
      document.getElementById('videographer').value = third;
      document.getElementById('equipment').value = "ENG";
    }
    document.getElementById('client').value = third;
  }

  if (location) {
    document.getElementById('location').value = location;
  }

  closeSMSPopup();
  saveData();
}



  document.getElementById('login-code').addEventListener('keydown', function(event) {
    if (event.key === 'Enter') login();
  });

  document.addEventListener("DOMContentLoaded", function() {
    const loginSection = document.getElementById("login-section");
    const formSection = document.getElementById("form-section");
    const logoWrapper = document.getElementById("login-logo-wrapper");
    function updateVisibility() {
      logoWrapper.style.display = loginSection.classList.contains("active") ? "block" : "none";
    }
    updateVisibility();
    const observer = new MutationObserver(updateVisibility);
    observer.observe(loginSection, { attributes: true, attributeFilter: ["class"] });
  });

  let autoSaveTimer;
  document.querySelectorAll('#form-section input, #form-section textarea').forEach(el => {
    el.addEventListener('input', () => {
      if (autoSaveTimer) clearTimeout(autoSaveTimer);
      autoSaveTimer = setTimeout(() => saveToServer(true), 10000);
    });
  });


function showCanteen() {
  document.getElementById('login-section').style.display = 'none';
  document.getElementById('form-section').style.display = 'none';
  document.getElementById('canteen-section').style.display = 'block';
  loadCanteenImages();
}

function handleCanteenUpload(event) {
  const gallery = document.getElementById('canteen-gallery');
  const files = Array.from(event.target.files);
  files.forEach(file => {
    const reader = new FileReader();
    reader.onload = function(e) {
      const key = file.name;
      const today = new Date();
      const fileDate = new Date("20" + key.substring(0, 2), parseInt(key.substring(2, 4)) - 1, key.substring(4, 6));
      if (fileDate >= today) {
        localStorage.setItem("canteen_" + key, e.target.result);
      }
      loadCanteenImages();
    };
    reader.readAsDataURL(file);
  });
}

function loadCanteenImages() {
  const gallery = document.getElementById('canteen-gallery');
  gallery.innerHTML = "";
  const today = new Date();
  for (let key in localStorage) {
    if (key.startsWith("canteen_")) {
      const dateStr = key.replace("canteen_", "").replace(".png", "");
      const date = new Date("20" + dateStr.substring(0, 2), parseInt(dateStr.substring(2, 4)) - 1, dateStr.substring(4, 6));
      if (date < today) {
        localStorage.removeItem(key);
        continue;
      }
      const img = document.createElement("img");
      img.src = localStorage.getItem(key);
      img.alt = key;
      img.style.maxWidth = "150px";
      img.style.maxHeight = "150px";
      img.style.border = "1px solid #ccc";
      gallery.appendChild(img);
    }
  }
}
</script>
<div id="canteen-section" style="display:none; text-align:center; margin-top:30px;">
<div id="loading-spinner" style="display:none;margin-top:10px;">
<span style="color:#004080;font-weight:bold;">이미지 불러오는 중...</span>
</div>
<div class="slider-wrapper" id="canteen-gallery" style="display: block;">&lt;div class="slider-container" id="sliderContainer"&gt;&lt;/div&gt;&lt;div class="slider-nav"&gt;&lt;button onclick="prevSlide()"&gt;이전&lt;/button&gt;&lt;button onclick="nextSlide()"&gt;다음&lt;/button&gt;&lt;/div&gt;</div>
<div id="canteen-controls" style="margin-top:20px;">
<label for="canteen-upload" style="background:#004080;color:white;padding:0.5rem 1.5rem;border-radius:5px;cursor:pointer;margin-right:10px;display:inline-block;font-family:'Nanum Barun Gothic',sans-serif;font-size:14px;font-weight:normal;">추가</label>
<input accept="image/*" id="canteen-upload" multiple="" onchange="handleCanteenUpload(event)" style="display:none;" type="file"/>
<button onclick="toggleEditMode()" style="background:#004080;color:white;padding:0.5rem 1.5rem;border-radius:5px;cursor:pointer;margin-right:10px;display:inline-block;font-family:'Nanum Barun Gothic',sans-serif;font-size:14px;font-weight:normal;">편집</button>
<button onclick="deleteSelectedImages()" style="background:#004080;color:white;padding:0.5rem 1.5rem;border-radius:5px;cursor:pointer;margin-right:10px;display:inline-block;font-family:'Nanum Barun Gothic',sans-serif;font-size:14px;font-weight:normal;">삭제</button>
</div>
</div>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script>
function showCanteen() {
  document.getElementById('login-section').style.display = 'none';
  document.getElementById('form-section').style.display = 'none';
  document.getElementById('canteen-section').style.display = 'block';
  loadCanteenImages();
}

function handleCanteenUpload(event) {
  const storageRef = firebase.storage().ref("canteen");
  const files = Array.from(event.target.files);

  files.forEach(file => {
    const fileName = file.name;
    const fileDate = new Date("20" + fileName.substring(0, 2), parseInt(fileName.substring(2, 4)) - 1, fileName.substring(4, 6));
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    if (fileDate >= today) {
      const ref = storageRef.child(fileName);
      ref.put(file).then(() => {
        loadCanteenImages();
      });
    } else {
      alert(fileName + " 은 과거 날짜이므로 업로드되지 않았습니다.");
    }
  });
}

function loadCanteenImages() {
  const gallery = document.getElementById('canteen-gallery');
  gallery.innerHTML = '';
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  const storageRef = firebase.storage().ref("canteen");
  storageRef.listAll().then(res => {
    const sortedItems = res.items.sort((a, b) => a.name.localeCompare(b.name));
    sortedItems.forEach(itemRef => {
      const fileName = itemRef.name;
      const fileDate = new Date("20" + fileName.substring(0, 2), parseInt(fileName.substring(2, 4)) - 1, fileName.substring(4, 6));

      if (fileDate < today) {
        // 과거 날짜면 삭제
        itemRef.delete();
      } else {
        itemRef.getDownloadURL().then(url => {
          const img = document.createElement("img");
          img.src = url;
          img.alt = fileName;
          img.style.maxWidth = "150px";
          img.style.maxHeight = "150px";
          img.style.border = "1px solid #ccc";
          gallery.appendChild(img);
        });
      }
    });
  });
}
</script>
<script>
let editMode = false;
let selectedToDelete = new Set();

function toggleEditMode() {
  editMode = !editMode;
  loadCanteenImages();
}

function deleteSelectedImages() {
  const storageRef = firebase.storage().ref("canteen");
  selectedToDelete.forEach(name => {
    storageRef.child(name).delete().then(() => {
      selectedToDelete.delete(name);
      loadCanteenImages();
    });
  });
}

function enlargeImage(src, alt) {
  const popup = document.createElement("div");
  popup.style.position = "fixed";
  popup.style.top = "0";
  popup.style.left = "0";
  popup.style.width = "100vw";
  popup.style.height = "100vh";
  popup.style.background = "rgba(0,0,0,0.8)";
  popup.style.display = "flex";
  popup.style.alignItems = "center";
  popup.style.justifyContent = "center";
  popup.style.zIndex = "10000";
  popup.onclick = () => document.body.removeChild(popup);

  const img = document.createElement("img");
  img.src = src;
  img.alt = alt;
  img.style.maxWidth = "90%";
  img.style.maxHeight = "90%";
  popup.appendChild(img);

  document.body.appendChild(popup);
}

function loadCanteenImages() {
  const gallery = document.getElementById('canteen-gallery');
  gallery.innerHTML = '';
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const storageRef = firebase.storage().ref("canteen");

  storageRef.listAll().then(res => {
    const items = res.items.sort((a, b) => a.name.localeCompare(b.name));
    items.forEach(itemRef => {
      const fileName = itemRef.name;
      const fileDate = new Date("20" + fileName.substring(0, 2), parseInt(fileName.substring(2, 4)) - 1, fileName.substring(4, 6));

      if (fileDate < today) {
        itemRef.delete();
      } else {
        itemRef.getDownloadURL().then(url => {
          const container = document.createElement("div");
          container.style.position = "relative";

          const img = document.createElement("img");
          img.src = url;
          img.alt = fileName;
          img.style.maxWidth = "150px";
          img.style.maxHeight = "150px";
          img.style.border = "1px solid #ccc";
          img.style.cursor = "pointer";
          img.onclick = () => {
            if (editMode) {
              if (selectedToDelete.has(fileName)) {
                selectedToDelete.delete(fileName);
                img.style.border = "1px solid #ccc";
              } else {
                selectedToDelete.add(fileName);
                img.style.border = "3px solid red";
              }
            } else {
              enlargeImage(url, fileName);
            }
          };

          container.appendChild(img);
          gallery.appendChild(container);
        });
      }
    });
  });
}
</script>
<script>
let editMode = false;
let selectedToDelete = new Set();

function toggleEditMode() {
  editMode = !editMode;
  selectedToDelete.clear();
  loadCanteenImages();
}

function deleteSelectedImages() {
  const storageRef = firebase.storage().ref("canteen");
  selectedToDelete.forEach(name => {
    storageRef.child(name).delete().then(() => {
      selectedToDelete.delete(name);
      loadCanteenImages();
    });
  });
}

function enlargeImage(src, alt) {
  const popup = document.createElement("div");
  popup.style.position = "fixed";
  popup.style.top = "0";
  popup.style.left = "0";
  popup.style.width = "100vw";
  popup.style.height = "100vh";
  popup.style.background = "rgba(0,0,0,0.8)";
  popup.style.display = "flex";
  popup.style.alignItems = "center";
  popup.style.justifyContent = "center";
  popup.style.zIndex = "10000";
  popup.onclick = () => document.body.removeChild(popup);

  const img = document.createElement("img");
  img.src = src;
  img.alt = alt;
  img.style.maxWidth = "90%";
  img.style.maxHeight = "90%";
  popup.appendChild(img);

  document.body.appendChild(popup);
}

function loadCanteenImages() {
  const gallery = document.getElementById('canteen-gallery');
  gallery.innerHTML = '';
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  const storageRef = firebase.storage().ref("canteen");

  storageRef.listAll().then(res => {
    const items = res.items.sort((a, b) => a.name.localeCompare(b.name));
    items.forEach(itemRef => {
      const fileName = itemRef.name;
      const fileDate = new Date("20" + fileName.substring(0, 2), parseInt(fileName.substring(2, 4)) - 1, fileName.substring(4, 6));

      if (fileDate < today) {
        itemRef.delete();
      } else {
        itemRef.getDownloadURL().then(url => {
          const container = document.createElement("div");
          container.style.position = "relative";

          const img = document.createElement("img");
          img.src = url;
          img.alt = fileName;
          img.style.maxWidth = "150px";
          img.style.maxHeight = "150px";
          img.style.border = "1px solid #ccc";
          img.style.margin = "5px";
          img.style.cursor = "pointer";

          img.onclick = () => {
            if (editMode) {
              if (selectedToDelete.has(fileName)) {
                selectedToDelete.delete(fileName);
                img.style.border = "1px solid #ccc";
              } else {
                selectedToDelete.add(fileName);
                img.style.border = "3px solid red";
              }
            } else {
              enlargeImage(url, fileName);
            }
          };

          container.appendChild(img);
          gallery.appendChild(container);
        });
      }
    });
  });
}

function goToLogin() {
  document.getElementById('login-section').classList.add('active');
  document.getElementById('login-section').style.display = 'block';
  document.getElementById('form-section').classList.remove('active');
  document.getElementById('form-section').style.display = 'none';
  document.getElementById('canteen-section').style.display = 'none';
  document.getElementById('login-logo-wrapper').style.display = 'block';
  currentUser = null;
}
</script>
<script>
let currentSlide = 0;

function showSlide(index) {
  const container = document.getElementById('sliderContainer');
  const totalSlides = container.children.length;
  if (index < 0) currentSlide = totalSlides - 1;
  else if (index >= totalSlides) currentSlide = 0;
  else currentSlide = index;
  container.style.transform = `translateX(-${currentSlide * 100}%)`;
}

function nextSlide() {
  showSlide(currentSlide + 1);
}

function prevSlide() {
  showSlide(currentSlide - 1);
}
</script></body>
</html>
